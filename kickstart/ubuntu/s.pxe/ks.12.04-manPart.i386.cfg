#Generated by Kickstart Configurator
#platform=AMD64 or Intel EM64T
# https://bugs.launchpad.net/ubuntu/+source/kickseed/+bug/420903/+viewstatus

#System timezone, language, modules, keyboard, mouse
timezone America/New_York
lang en_US
langsupport en_US
keyboard us
mouse

#Root password: Generate iscrypted; openssl passwd -1
auth  --useshadow  --enablemd5
rootpw --disabled
user msalisbury --fullname "Michael Salisbury" --iscrypted --password $1$BBtB2HFR$IgUrgjqXCjo5Jl8ANB87F.
#Reboot after installation

#Instalation: Modes [text,graphical] [interactive,autostep] [install,upgrade] [halt,reboot]
graphical
interactive
install
reboot
#Run the Setup Agent on first boot
firstboot --enable


#Instalation source: Currently the ubuntu alternate cd is partially corrupt.
#url --url http://archive.ubuntu.com/ubuntu
url --url http://192.168.248.24/repo-12.04-alternate-i386

#Hard Drive Setup: Commenting out clearpart and part statements will prompt user for manual HD config
bootloader --location=mbr
zerombr yes
#clearpart --all --initlabel
#part swap --recommended
#part /boot --fstype ext2 --size 300
#part /     --fstype ext3 --size 1 --grow

#Network
network --bootproto=dhcp --device=eth0 --hostname=rename-me.pig.pie
firewall --disabled


#Desktop: X Window System configuration information
xconfig --depth=32 --resolution=1024x768 --defaultdesktop=GNOME --startxonboot


# NTP
preseed clock-setup/ntp boolean true
preseed clock-setup/ntp-server string ntp.myfloridacity.us

# Pre Install Config
%pre
# Pre-install script âeware that at this point
# the system is not yet installed and the target
# filesystem may not yet be created. That means
# you can't yet do any changes to it!

# This is the trick âutomatically switch to 6th console
# and redirect all input/output
exec < /dev/tty6 > /dev/tty6 2> /dev/tty6
chvt 6

# Or even run a python script
/bin/sh << __EOF__
# Any other Python code can come here
echo "This is pre-install shell"
sleep 3
__EOF__

# We can break into a shell prompt
#/bin/sh

# Then switch back to Anaconda on the first console
chvt 1
exec < /dev/tty1 > /dev/tty1 2> /dev/tty1

#preseed --owner d-i apt-setup/security_host string security.ubuntu.com
#preseed --owner netcfg netcfg/dhcp_timeout string 60

# perform unattended package upgrades
#preseed d-i pkgsel/update-policy select unattended-upgrades

# attempt a retry if the apt-cacher mirror fails for some reason
#preseed d-i apt-setup/mirror/error select Retry

# repos:
#preseed --owner d-i apt-setup/universe boolean true
#preseed --owner d-i apt-setup/multiverse boolean true
#preseed --owner d-i apt-setup/non-free boolean true

#Package install information
%packages --resolvedeps
#@ standard
#@ base
#@ core
#@ ubuntu-standard
#@ kubuntu-desktop
#@ edubuntu-desktop
#@ dns-server
#@ lamp-server
@ ubuntu-desktop
openssh-server

# Post Install Script
%post --interpreter /bin/bash
# Admin User
user=msalisbury

# enable useful repositories
preseed --owner d-i apt-setup/universe boolean true
preseed --owner d-i apt-setup/multiverse boolean true
preseed --owner d-i apt-setup/non-free boolean true

# Auto-accept licenses for Java and VMware
preseed --owner sun-java6-jdk shared/accepted-sun-dlj-v1-1 boolean true
preseed --owner sun-java6-jre shared/accepted-sun-dlj-v1-1 boolean true
preseed --owner vmware-player shared/accepted-vmware-player-v1-0-2 boolean true

#-----------------------------------------------------------------------/root/post-install-scripts
mkdir      /root/post-install-scripts
wget -q -O /root/post-install-scripts/runonce-12.04.sh http://192.168.248.24/config/runonce-12.04_firewall.sh
chmod +x   /root/post-install-scripts/runonce-12.04.sh

#-----------------------------------------------------------------------/etc/sudoers
cat << END-OF-SUDOERS >> /etc/sudoers

${user}   ALL=(ALL)       NOPASSWD:       ALL
END-OF-SUDOERS

#-----------------------------------------------------------------------/etc/hostname
cat << END-OF-HOSTNAME >> /etc/hostname
myFirewall.pig.pie
END-OF-HOSTNAME

#-----------------------------------------------------------------------/etc/hosts
cat << END-OF-HOSTS >> /etc/hosts
127.0.0.1       localhost
127.0.1.1       myFirewall.pig.pie	myFirewall

# The following lines are desirable for IPv6 capable hosts
::1     ip6-localhost ip6-loopback
fe00::0 ip6-localnet
ff00::0 ip6-mcastprefix
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters
END-OF-HOSTS

#-----------------------------------------------------------------------/etc/rc.local
sed -i '/^exit 0$/d'      /etc/rc.local
cat << END-OF-RC.LOCAL >> /etc/rc.local
/root/post-install-scripts/runonce-12.04.sh >> /var/log/runonce-12.04.sh 2>&1 &
exit 0
END-OF-RC.LOCAL

#-----------------------------------------------------------------------/home/localcosadmin/.ssh/authorized_keys
        mkdir /home/${user} 
        mkdir /home/${user} /.ssh
cat << EOF >> /home/${user} /.ssh/authorized_keys
ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEAofjHmUuZrNEsTUSx/Agb5bJOGP57DvbLxAh9xsBniAvyA7I3X68TAJZixWKQEs4SbhNhkO5wcZwC/9k/j2GXpvKEFewscxlw9X1/Mcxcpndl94Yptei2klBb5WKNSFJ06GxkxM/AtfXK6IQtKr/qiQfg/pdvwQ/X51kKFp8DQdiaUz5GgEqh19y6+uCfqGJsOkNph/9cGJGeJxRxJjuwghI3fmb9QapxLSqcQBJ++0GDo4UyO5smJgBiyL96g3sOzB4H/UMGdnQqsemLGvRmu60Jmy15D0I1XDfcN29kYOfoxYzkpbxvp3P9F/BL/Yao/J3x1Cz1U17GqRduTgnwrQ== root@RHEL01.localdomain
ssh-rsa AAAAB3NzaC1yc2EAAAABJQAAAIEAmMckh4/gd/8LK4wpmhdcnSEzLuDR+aiNojMI5j3enNRiJ4Kml4+JxlwllosZW2soz8i6THVEzp24d39XrfrXmopXQaUr+D41ES0WDbq0ZNu2hxLVxwLFimbo7xdRKs5+e8VuBBbH7gIvGYdmUGWEN8972S2UJpJnupgw4WaOg8U= rsa-key-20110617
EOF
        chown -R 1000 /home/${user} 
        chgrp -R 1000 /home/${user} 
        chmod 744     /home/${user} /.ssh
        chmod 600     /home/${user} /.ssh/*

#-----------------------------------------------------------------------/root/.ssh/authorized_keys
        mkdir /root/.ssh
cat << EOF >> /root/.ssh/authorized_keys
ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEAofjHmUuZrNEsTUSx/Agb5bJOGP57DvbLxAh9xsBniAvyA7I3X68TAJZixWKQEs4SbhNhkO5wcZwC/9k/j2GXpvKEFewscxlw9X1/Mcxcpndl94Yptei2klBb5WKNSFJ06GxkxM/AtfXK6IQtKr/qiQfg/pdvwQ/X51kKFp8DQdiaUz5GgEqh19y6+uCfqGJsOkNph/9cGJGeJxRxJjuwghI3fmb9QapxLSqcQBJ++0GDo4UyO5smJgBiyL96g3sOzB4H/UMGdnQqsemLGvRmu60Jmy15D0I1XDfcN29kYOfoxYzkpbxvp3P9F/BL/Yao/J3x1Cz1U17GqRduTgnwrQ== root@RHEL01.localdomain
ssh-rsa AAAAB3NzaC1yc2EAAAABJQAAAIEAmMckh4/gd/8LK4wpmhdcnSEzLuDR+aiNojMI5j3enNRiJ4Kml4+JxlwllosZW2soz8i6THVEzp24d39XrfrXmopXQaUr+D41ES0WDbq0ZNu2hxLVxwLFimbo7xdRKs5+e8VuBBbH7gIvGYdmUGWEN8972S2UJpJnupgw4WaOg8U= rsa-key-20110617
EOF
        chown -R root.root /root/.ssh
        chmod 744          /root/.ssh
        chmod 600          /root/.ssh/*

#-----------------------------------------------------------------------/etc/hostname
sed -i '/kickseed/d' /etc/hostname
#-----------------------------------------------------------------------/etc/apt/sources.list
sed -i 's|http://192.168.248.24/repo-12.04-alternate-i386/|http://archive.ubuntu.com/ubuntu/|' /etc/apt/sources.list

#-----------------------------------------------------------------------/Post install prompt
# Post-install script
exec < /dev/tty6 > /dev/tty6 2> /dev/tty6
chvt 6

/bin/bash << __EOF__
# Any other Python code can come here
echo "This is post-install shell"
sleep 3
__EOF__

# We can break into a shell prompt
#/bin/bash

# Then switch back to Anaconda on the first console
chvt 1
exec < /dev/tty1 > /dev/tty1 2> /dev/tty1



